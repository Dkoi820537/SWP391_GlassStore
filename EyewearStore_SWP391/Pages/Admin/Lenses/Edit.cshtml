@page
@model EyewearStore_SWP391.Pages.Admin.Lenses.EditModel
@{
    ViewData["Title"] = "Edit Lens";
    Layout = "_Layout";
}

<link rel="stylesheet" href="~/css/lenses-admin.css" asp-append-version="true" />

<div class="admin-container">
    <!-- Breadcrumb -->
    <nav class="admin-breadcrumb" aria-label="breadcrumb">
        <a href="/">Home</a>
        <span class="separator">â€º</span>
        <a href="/Admin">Admin</a>
        <span class="separator">â€º</span>
        <a href="/Admin/Lenses">Lenses</a>
        <span class="separator">â€º</span>
        <span>Edit</span>
    </nav>

    <!-- Header -->
    <div class="admin-header">
        <h1>Edit Lens</h1>
        <div class="admin-header-actions">
            <button type="button" class="btn btn-outline-primary" onclick="LensAdmin.confirmDelete(@Model.LensId)" style="border-color: var(--error); color: var(--error);">
                Delete Lens
            </button>
        </div>
    </div>

    <!-- Form -->
    <form id="lensForm" class="admin-form" novalidate>
        <input type="hidden" name="lensId" value="@Model.LensId">

        <!-- Basic Information -->
        <div class="form-section">
            <h2 class="form-section-title">Basic Information</h2>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="lensType">Lens Type <span style="color: var(--error);">*</span></label>
                    <select id="lensType" name="lensType" required aria-required="true">
                        <option value="">Select lens type</option>
                        <option value="Single Vision">Single Vision</option>
                        <option value="Bifocal">Bifocal</option>
                        <option value="Progressive">Progressive</option>
                        <option value="Reading">Reading</option>
                    </select>
                    <span class="error-message">Lens type is required</span>
                </div>

                <div class="form-group">
                    <label for="indexValue">Index Value</label>
                    <input type="number" 
                           id="indexValue" 
                           name="indexValue" 
                           step="0.01" 
                           min="1.0" 
                           max="2.0" 
                           placeholder="e.g., 1.50, 1.60, 1.67"
                           aria-describedby="indexValueHelp">
                    <small id="indexValueHelp" style="color: var(--secondary-warm-gray);">
                        Refractive index between 1.0 and 2.0
                    </small>
                    <span class="error-message">Index value must be between 1.0 and 2.0</span>
                </div>
            </div>

            <div class="form-group">
                <label for="coating">Coating</label>
                <input type="text" 
                       id="coating" 
                       name="coating" 
                       maxlength="100"
                       placeholder="e.g., Anti-Reflective, Blue Light Filter, Transition">
                <span class="error-message">Coating cannot exceed 100 characters</span>
            </div>
        </div>

        <!-- Pricing & Stock -->
        <div class="form-section">
            <h2 class="form-section-title">Pricing & Stock</h2>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="price">Price ($) <span style="color: var(--error);">*</span></label>
                    <input type="number" 
                           id="price" 
                           name="price" 
                           step="0.01" 
                           min="0.01" 
                           required
                           placeholder="0.00"
                           aria-required="true">
                    <span class="error-message">Price must be greater than 0</span>
                </div>

                <div class="form-group">
                    <label for="stockStatus">Stock Status</label>
                    <select id="stockStatus" name="stockStatus">
                        <option value="in-stock">In Stock</option>
                        <option value="low-stock">Low Stock</option>
                        <option value="out-of-stock">Out of Stock</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Images -->
        <div class="form-section">
            <h2 class="form-section-title">Images</h2>
            
            <div id="imageUploadZone" class="image-upload-zone" role="button" tabindex="0" aria-label="Upload images">
                <div class="upload-icon">ðŸ“·</div>
                <p class="upload-text">Drag and drop images here, or click to select</p>
                <p class="upload-hint">Supported formats: JPG, PNG, WebP. Max size: 5MB</p>
            </div>
            <input type="file" 
                   id="imageInput" 
                   accept=".jpg,.jpeg,.png,.webp" 
                   multiple 
                   hidden
                   aria-hidden="true">
            
            <div id="imagePreviewGrid" class="image-preview-grid"></div>
        </div>

        <!-- Form Actions -->
        <div class="form-actions">
            <a href="/Admin/Lenses" class="btn btn-secondary">Cancel</a>
            <button type="submit" class="btn btn-primary">Update Lens</button>
        </div>
    </form>
</div>

<!-- Delete Confirmation Modal -->
<div id="deleteModal" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="deleteModalTitle">
    <div class="modal-content">
        <h2 id="deleteModalTitle" class="modal-title">Confirm Delete</h2>
        <div class="modal-body">
            <p>Are you sure you want to delete this lens? This action will mark the lens as inactive (out of stock).</p>
        </div>
        <div class="modal-actions">
            <button type="button" class="btn btn-secondary" onclick="LensAdmin.hideDeleteModal()">Cancel</button>
            <button type="button" class="btn btn-primary" style="background: var(--error);" onclick="LensAdmin.executeDelete()">Delete</button>
        </div>
    </div>
</div>

<!-- Loading Overlay -->
<div id="loadingOverlay" class="loading-overlay" style="display: none;">
    <div class="loading-spinner"></div>
</div>

<!-- Toast Container -->
<div id="toastContainer" class="toast-container"></div>

@section Scripts {
    <script src="~/js/lenses-admin.js" asp-append-version="true"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            LensAdmin.init({ page: 'edit', lensId: @Model.LensId });
        });
    </script>
}
